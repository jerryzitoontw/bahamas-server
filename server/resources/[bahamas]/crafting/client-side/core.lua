-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
vSERVER = Tunnel.getInterface("crafting")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local Timer = 0
local Select = ""
-----------------------------------------------------------------------------------------------------------------------------------------
-- LIST
-----------------------------------------------------------------------------------------------------------------------------------------
local List = {
	-- Framework
	["1"] = { 713.66,-961.04,30.4,"Dress" },
	["2"] = { -382.72,261.91,86.36,"Food" },
	["3"] = { 1991.28,3724.65,34.83,"Food" },
	["4"] = { 82.45,-1553.26,29.59,"Lixeiro" },
	["5"] = { 287.36,2843.6,44.7,"Lixeiro" },
	["6"] = { -413.68,6171.99,31.48,"Lixeiro" },
	["7"] = { 2921.17,2653.46,43.31,"Mining" },
	["8"] = { 894.5,-962.71,35.63,"Money" },
	["9"] = { 1209.28,-3115.1,5.61,"Weapons" },
	-- Restaurants
	["10"] = { -1847.16,-1194.05,14.28,"Pearls" },
	-- Contraband
	["11"] = { 2186.77,5581.2,53.9,"Chiliad" },
	["12"] = { -161.72,-1609.33,33.46,"Families" },
	["13"] = { 1421.29,6328.41,23.87,"Highways" },
	["14"] = { 325.69,-1997.49,24.02,"Vagos" },
	-- Favelas
	["15"] = { 1356.56,-259.51,152.02,"Favela-1" },
	["16"] = { 3176.13,5142.38,31.51,"Favela-2" },
	["17"] = { 402.93,756.95,194.62,"Favela-3" },
	["18"] = { 2175.04,4045.95,34.36,"Favela-4" },
	["19"] = { 1550.16,-2454.24,80.37,"Favela-5" },
	["20"] = { -3110.99,1422.21,29.97,"Favela-6" },
	["21"] = { -3130.2,1702.83,41.01,"Favela-7" },
	["22"] = { -601.03,2197.69,126.27,"Favela-8" },
	-- Mafias
	["23"] = { 1400.84,1138.64,109.63,"Madrazzo" },
	["24"] = { -1543.54,79.91,57.00,"Playboy" },
	["25"] = { 951.87,-116.01,74.99,"TheSouth" },
	["26"] = { -1871.2,2061.28,135.28,"Vineyard" }
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADSTART
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	for Number,v in pairs(List) do
		exports["target"]:AddCircleZone("Crafting:"..Number,vec3(v[1],v[2],v[3]),0.5,{
			name = "Crafting:"..Number,
			heading = 3374176
		},{
			shop = Number,
			Distance = 1.0,
			options = {
				{
					event = "crafting:Open",
					label = "Abrir",
					tunnel = "shop"
				}
			}
		})
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING:OPEN
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("crafting:Open",function(Number)
	if List[Number] then
		if vSERVER.Permission(Number,List[Number][4]) then
			if List[Number][4] ~= Select and GetGameTimer() < Timer then
				TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
			else
				Select = List[Number][4]
				SetNuiFocus(true,true)
				SendNUIMessage({ action = "OpenCraft", data = vSERVER.Request(Select) })
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Close",function(Data,Callback)
	SetNuiFocus(false,false)

	Callback("Ok")
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- OWNED
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Owned",function(Data,Callback)
	Callback(vSERVER.Owned(Data["id"],Data["key"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Crafting",function(Data,Callback)
	if GetGameTimer() >= Timer then
		Timer = GetGameTimer() + Data["time"] * 1000

		SetTimeout(Data["time"] * 1000,function()
			vSERVER.Crafting(Data["id"],Data["key"],Data["amount"])
		end)

		Callback(true)
	else
		TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
		Callback(false)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING:INVENTORY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("crafting:Inventory")
AddEventHandler("crafting:Inventory",function()
	if "Inventory" ~= Select and GetGameTimer() < Timer then
		TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
		return
	end

	Select = "Inventory"
	SetNuiFocus(true,true)
	SendNUIMessage({ action = "OpenCraft", data = vSERVER.Request("Inventory") })
end)